# Stock Analyzer 股票分析系统 - 架构设计文档

## 版本信息
- 版本: v1.0
- 日期: 2026-02-20
- 作者: 林海

---

## 1. 文档概述

### 1.1 目的
本文档描述 Stock Analyzer 股票分析系统的整体架构设计，包括系统架构、技术选型、部署架构和关键设计决策。

### 1.2 范围
涵盖前端展示层、后端服务层、数据存储层以及基础设施层的设计。

---

## 2. 系统架构

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户访问层                                │
│   Web浏览器 / 移动端                                               │
└──────────────────────────┬────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                        负载均衡层                                │
│   Nginx (反向代理 + 静态资源 serving)                            │
└──────────────────────────┬────────────────────────────────────────┘
                          │
          ┌───────────────┴───────────────┐
          ▼                               ▼
┌─────────────────────┐      ┌─────────────────────┐
│    Web前端服务       │      │    API后端服务       │
│  (React + Vite)     │◄────►│  (Node.js + Express)│
│      端口: 5173     │      │      端口: 3001     │
└─────────────────────┘      └──────────┬──────────┘
                                         │
                                         ▼
                              ┌─────────────────────┐
                              │    数据存储层        │
                              │  ┌───────────────┐  │
                              │  │ MongoDB       │  │
                              │  │ 端口: 27017   │  │
                              │  └───────────────┘  │
                              │  ┌───────────────┐  │
                              │  │ Redis         │  │
                              │  │ 端口: 6379    │  │
                              │  └───────────────┘  │
                              └─────────────────────┘
```

### 2.2 架构分层

| 层级 | 组件 | 职责 |
|------|------|------|
| 展示层 | React + Ant Design | 用户界面、图表展示、交互 |
| 业务层 | Express + 业务模块 | API接口、业务逻辑、数据处理 |
| 数据层 | MongoDB + Redis | 持久化存储、缓存、会话管理 |
| 通信层 | WebSocket + HTTP | 实时推送、Restful API |

---

## 3. 技术栈选型

### 3.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.2.0 | UI框架 |
| TypeScript | 4.9.3 | 类型安全 |
| Vite | 4.1.0 | 构建工具 |
| Ant Design | 5.x | UI组件库 |
| ECharts | 5.4.0 | 图表库 |
| Redux Toolkit | 1.9.3 | 状态管理 |
| React Router | 6.8.1 | 路由管理 |
| Axios | 1.6.0 | HTTP客户端 |
| Socket.io-client | 4.7.0 | WebSocket客户端 |

### 3.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | 18.x LTS | 运行时 |
| Express | 4.x | Web框架 |
| TypeScript | 4.9.3 | 类型安全 |
| Mongoose | 7.x | MongoDB ODM |
| Redis | 7.x | 缓存/消息队列 |
| WebSocket (ws) | 8.x | 实时通信 |

### 3.3 基础设施

| 技术 | 用途 |
|------|------|
| Docker | 容器化部署 |
| Docker Compose | 多服务编排 |
| Nginx | Web服务器、反向代理 |
| MongoDB | NoSQL数据库 |
| Redis | 内存数据库、缓存 |

---

## 4. 模块设计

### 4.1 系统模块划分

```
┌─────────────────────────────────────────────────────────────┐
│                        Stock Analyzer                         │
├─────────────┬─────────────┬─────────────┬─────────────────────┤
│  行情模块    │  自选股模块  │  预警模块    │   资讯模块          │
├─────────────┼─────────────┼─────────────┼─────────────────────┤
│ - 大盘指数   │ - 股票管理   │ - 价格预警   │ - 新闻列表          │
│ - 个股行情   │ - 分组管理   │ - 涨跌幅预警 │ - 个股资讯          │
│ - K线图表   │ - 自选列表   │ - 成交量预警   │ - 实时推送          │
│ - 技术指标   │ - 快速添加   │ - 预警开关   │                     │
└─────────────┴─────────────┴─────────────┴─────────────────────┘
```

### 4.2 模块依赖关系

```
                    用户认证模块
                         │
        ┌────────────────┼────────────────┐
        ▼                ▼                ▼
   行情数据模块      自选股模块        预警模块
        │                │                │
        └────────────────┼────────────────┘
                         ▼
                    消息推送模块
```

---

## 5. 部署架构

### 5.1 容器化部署架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Docker Host (38.246.248.181)              │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐   │
│   │                  Docker Network                        │   │
│   │               stock-analyzer_stock-network            │   │
│   │                                                      │   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│   │  │   nginx     │  │  node-web   │  │ node-server │  │   │
│   │  │   (5173)    │  │   (5173)    │  │   (3001)    │  │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│   │                                                      │   │
│   │  ┌─────────────┐  ┌─────────────┐                  │   │
│   │  │   mongo     │  │   redis     │                  │   │
│   │  │  (27017)    │  │   (6379)    │                  │   │
│   │  └─────────────┘  └─────────────┘                  │   │
│   │                                                      │   │
│   └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 服务配置

| 服务 | 容器名 | 端口映射 | 依赖 |
|------|--------|----------|------|
| Web Frontend | stock-analyzer-web | 5173:5173 | 无 |
| API Server | stock-analyzer-server | 3001:3001 | mongo, redis |
| MongoDB | stock-analyzer-mongo | 27017:27017 | 无 |
| Redis | stock-analyzer-redis | 6379:6379 | 无 |

---

## 6. 关键技术决策

### 6.1 为何选择 React + TypeScript
- **组件化开发**: 易于维护和复用
- **类型安全**: 减少运行时错误
- **生态丰富**: 大量优质库和工具

### 6.2 为何选择 Express + Node.js
- **JavaScript全栈**: 前后端统一语言
- **非阻塞I/O**: 适合高并发场景
- **实时通信**: WebSocket原生支持

### 6.3 为何选择 MongoDB
- **灵活Schema**: 适应股票数据动态变化
- **高性能**: 适合读写密集型应用
- **地理分布**: 易于扩展

### 6.4 为何选择 Docker 部署
- **环境一致性**: 开发/测试/生产环境统一
- **快速部署**: 一键启动所有服务
- **资源隔离**: 各服务独立运行

---

## 7. 性能设计

### 7.1 前端优化
- **代码分割**: 按需加载路由组件
- **虚拟滚动**: 长列表性能优化
- **防抖节流**: 频繁操作控制
- **缓存策略**: Redux状态持久化

### 7.2 后端优化
- **数据库索引**: 股票代码、时间字段索引
- **Redis缓存**: 热门股票数据缓存
- **WebSocket推送**: 减少轮询开销
- **连接池**: 数据库连接复用

### 7.3 网络优化
- **Gzip压缩**: 减少传输体积
- **CDN加速**: 静态资源分发
- **Keep-Alive**: 连接复用

---

## 8. 安全设计

### 8.1 传输安全
- HTTPS加密通信（生产环境）
- WebSocket WSS协议

### 8.2 API安全
- CORS跨域控制
- 请求限流
- 参数校验

### 8.3 数据安全
- MongoDB认证
- Redis密码保护
- 敏感数据加密存储

---

## 9. 扩展性设计

### 9.1 水平扩展
- 无状态API服务，支持多实例部署
- MongoDB分片集群
- Redis Cluster模式

### 9.2 垂直扩展
- 微服务拆分（用户服务、行情服务、预警服务）
- 消息队列引入（处理异步任务）
- 实时计算引擎（Flink/Storm）

---

## 10. 监控与运维

### 10.1 日志监控
- 应用日志集中收集
- Docker日志驱动配置

### 10.2 指标监控
- 服务健康检查端点 (`/health`)
- Prometheus + Grafana 监控

### 10.3 告警机制
- 服务异常自动告警
- 资源使用率告警

---

## 文档修订历史

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-20 | 初始版本 | 林海 |
